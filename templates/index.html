<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Janet the ScamBot - Vapi Voice Assistant</title>
  <link
    href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
    rel="stylesheet"
  />
  <style>
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: .5; }
    }
    .status-active { background-color: #10B981; }
    .status-inactive { background-color: #6B7280; }
    .status-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 8px;
    }
  </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen text-white">
  <div class="text-center mb-8">
    <h1 class="text-4xl sm:text-5xl font-bold mb-2">Janet the ScamBot</h1>
  </div>

  <div class="bg-white bg-opacity-20 backdrop-blur-lg rounded-2xl p-8 shadow-2xl max-w-md w-full">
    <div class="flex items-center justify-center mb-6">
      <span class="status-indicator" id="status-indicator"></span>
      <span id="status-text" class="text-lg">Disconnected</span>
    </div>

    <div class="text-center mb-6">
      <div id="call-status" class="text-2xl font-bold mb-2">Ready to Connect</div>
      <div id="call-timer" class="text-sm opacity-75 hidden">00:00</div>
    </div>

    <button
      id="call-button"
      class="w-full bg-green-500 hover:bg-green-600 text-white px-6 py-4 rounded-lg shadow-md transition-all duration-150 ease-in-out text-lg font-semibold"
    >
      Start Call with Janet
    </button>

    <div id="error-container" class="mt-4 text-center text-sm text-red-300"></div>
  </div>

  <!-- Vapi SDK (UMD build for browsers) -->
  <script src="https://cdn.jsdelivr.net/npm/@vapi-ai/web@latest/dist/vapi.umd.js"></script>

  <script>
    // Vapi configuration
    const VAPI_CONFIG = {
        publicKey: '1c13d18f-bdb2-4195-9b54-5bd3d7f2be21',
        assistantId: 'a0f2248e-143f-43a0-8130-7f386a16a94a'
    };

    // Log configuration for debugging
    console.log('Using VAPI configuration:', VAPI_CONFIG);

    // DOM elements
    const callButton = document.getElementById('call-button');
    const statusIndicator = document.getElementById('status-indicator');
    const statusText = document.getElementById('status-text');
    const callStatus = document.getElementById('call-status');
    const callTimer = document.getElementById('call-timer');
    const errorContainer = document.getElementById('error-container');

    // Initialize Vapi
    const vapi = new Vapi(VAPI_PUBLIC_KEY);

    // Call state
    let isCallActive = false;
    let callStartTime = null;
    let timerInterval = null;

    // Update UI functions
    function updateStatus(connected, text) {
      statusIndicator.className = `status-indicator ${
        connected ? 'status-active' : 'status-inactive'
      }`;
      statusText.textContent = text || (connected ? 'Connected' : 'Disconnected');
    }

    function updateCallButton(active) {
      if (active) {
        callButton.textContent = 'End Call';
        callButton.classList.remove('bg-green-500', 'hover:bg-green-600');
        callButton.classList.add('bg-red-500', 'hover:bg-red-600');
      } else {
        callButton.textContent = 'Start Call with Janet';
        callButton.classList.remove('bg-red-500', 'hover:bg-red-600');
        callButton.classList.add('bg-green-500', 'hover:bg-green-600');
      }
    }

    function showError(message) {
      errorContainer.textContent = message;
      setTimeout(() => {
        errorContainer.textContent = '';
      }, 5000);
    }

    function updateTimer() {
      if (!callStartTime) return;
      const elapsed = Math.floor((Date.now() - callStartTime) / 1000);
      const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
      const seconds = (elapsed % 60).toString().padStart(2, '0');
      callTimer.textContent = `${minutes}:${seconds}`;
    }

    // Vapi event listeners
    vapi.on('call-start', () => {
      isCallActive = true;
      callStartTime = Date.now();
      updateStatus(true, 'Connected');
      updateCallButton(true);
      callStatus.textContent = 'Talking with Janet';
      callTimer.classList.remove('hidden');
      timerInterval = setInterval(updateTimer, 1000);
    });

    vapi.on('call-end', () => {
      isCallActive = false;
      callStartTime = null;
      updateStatus(false, 'Disconnected');
      updateCallButton(false);
      callStatus.textContent = 'Call Ended';
      clearInterval(timerInterval);
      setTimeout(() => {
        callStatus.textContent = 'Ready to Connect';
        callTimer.classList.add('hidden');
        callTimer.textContent = '00:00';
      }, 2000);
    });

    vapi.on('speech-start', () => {
      callStatus.textContent = 'Listening…';
    });

    vapi.on('speech-end', () => {
      callStatus.textContent = 'Processing…';
    });

    vapi.on('message', (message) => {
      if (message.type === 'transcript' && message.role === 'assistant') {
        callStatus.textContent = 'Janet is speaking';
      }
    });

    vapi.on('error', (error) => {
      showError(error.message || 'An error occurred');
    });

    // Call button handler
    callButton.addEventListener('click', async () => {
      try {
        if (isCallActive) {
          vapi.stop();
        } else {
          callStatus.textContent = 'Connecting…';
          await vapi.start({
            assistantId: ASSISTANT_ID,
            variables: {
              userName: 'Friend',
              sessionId: 'session_' + Date.now(),
            },
          });
        }
      } catch {
        showError('Failed to connect. Please try again.');
        updateStatus(false);
        updateCallButton(false);
        callStatus.textContent = 'Connection Failed';
      }
    });

    // Initialize status
    updateStatus(false);
    console.log('Vapi assistant ready');
  </script>
</body>
</html>








