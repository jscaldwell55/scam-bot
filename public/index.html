<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Janet Scambot - Vapi Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      background-color: #f5f5f5;
    }
    h1 {
      margin-bottom: 20px;
      color: #333;
    }
    #status {
      margin-bottom: 20px;
      font-size: 18px;
      color: #666;
    }
    button {
      margin: 10px;
      padding: 14px 28px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      border-radius: 6px;
      background-color: #005eff;
      color: white;
      transition: background-color 0.2s ease;
    }
    button:hover {
      background-color: #0041c4;
    }
    button:disabled {
      background-color: #aaa;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <h1>Janet Scambot</h1>
  <div id="status">Awaiting interaction...</div>
  <button id="start-btn">Start Call</button>
  <button id="stop-btn" disabled>End Call</button>

  <!-- ‚úÖ Correct working Vapi SDK from unpkg -->
  <script src="https://unpkg.com/@vapi-ai/web@latest/dist/index.umd.js"></script>

  <script>
    // Prompt for mic access immediately
    navigator.mediaDevices.getUserMedia({ audio: true })
      .then(() => console.log("Microphone permission granted."))
      .catch(err => console.warn("Microphone permission denied:", err));

    console.log("Attempting to initialize Vapi SDK...");

    try {
      if (typeof Vapi === 'undefined') {
        console.error("Vapi is undefined. SDK failed to load.");
      } else {
        const vapi = new Vapi('1c13d18f-bdb2-4195-9b54-5bd3d7f2be21');

        const startBtn = document.getElementById("start-btn");
        const stopBtn = document.getElementById("stop-btn");
        const statusEl = document.getElementById("status");

        const setStatus = (text) => {
          statusEl.textContent = text;
        };

        vapi.on('call-start', () => {
          setStatus("üé§ Listening...");
          startBtn.disabled = true;
          stopBtn.disabled = false;
        });

        vapi.on('speech-start', () => setStatus("üó£Ô∏è Speaking..."));
        vapi.on('speech-end', () => setStatus("üé§ Listening..."));
        vapi.on('call-end', () => {
          setStatus("‚úÖ Conversation ended.");
          startBtn.disabled = false;
          stopBtn.disabled = true;
        });

        vapi.on('error', (e) => {
          console.error("Vapi error:", e);
          setStatus("‚ö†Ô∏è Error occurred.");
          startBtn.disabled = false;
          stopBtn.disabled = true;
        });

        startBtn.addEventListener("click", () => {
          setStatus("‚è≥ Starting call...");
          try {
            vapi.start('a0f2248e-143f-43a0-8130-7f386a16a94a');
          } catch (error) {
            console.error("Error calling vapi.start():", error);
            setStatus("‚ùå Failed to start call.");
          }
        });

        stopBtn.addEventListener("click", () => {
          try {
            vapi.stop();
            setStatus("üõë Ending call...");
          } catch (error) {
            console.error("Error calling vapi.stop():", error);
            setStatus("‚ùå Failed to stop call.");
          }
        });
      }
    } catch (error) {
      console.error("Vapi init error:", error);
    }
  </script>
</body>
</html>
